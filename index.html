<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>NISRA Custom Area Profile Builder</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    
    <link rel="icon" type="image" href="img/favicon-daera.svg">

    <!-- imports for bootstrap - jquery and popper are dependencies -->
    <script src="https://cdn.jsdelivr.net/gh/jquery/jquery@3.4.1/dist/jquery.min.js"></script>
    <link href="https://cdn.jsdelivr.net/gh/twbs/bootstrap@v4.5.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/gh/FezVrasta/popper.js@v1.16.1/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/twbs/bootstrap@v4.5.2/dist/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

    <!-- fontawesome import -->
    <script src="https://kit.fontawesome.com/ee3848f0f5.js" crossorigin="anonymous"></script>

    <!-- chart.js and add ons -->
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/chart.js/dist/chart.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chartjs-plugin-annotation/3.0.1/chartjs-plugin-annotation.min.js" integrity="sha512-Hn1w6YiiFw6p6S2lXv6yKeqTk0PLVzeCwWY9n32beuPjQ5HLcvz5l2QsP+KilEr1ws37rCTw3bZpvfvVIeTh0Q==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>
    <link href="https://unpkg.com/maplibre-gl@2.4.0/dist/maplibre-gl.css" rel="stylesheet" />
    <link rel ="stylesheet" href ="style.css">

  </head>

  <body>
    <div class="wrapper">
          
      <div class="content-wrapper">

      <nav class="navbar py-3" style="background-color:#00205b;">
        <div class="container-fluid d-flex align-items-center">

          <!-- Logo (left) -->
          <a class="navbar-brand ps-2 d-flex align-items-center me-auto" href="#">
            <img src="img/nisra-logo-unstacked-white.svg" alt="NISRA logo" height="60" class="me-3">
          </a>

          <!-- Heading (right) -->
          <h1 class="mb-0 pe-2 text-white fs-2 app-title ms-2">NISRA Profile Builder</h1>

        </div>
      </nav>

      <hr style="border-top: 4px solid #3878c5; margin: 0">

      <div id="main-container">

        <div id="map-content" class="screen">                  
            <div class="div-style-bar">
              <div class="map-and-controls">
                <!--category selector -->                
                <div id="map-wrapper">
                  <div id="lgd-selector" class="lgd-selector">
                    <div class="zone-selector-box">
                      <label for="zone-selector"><strong>Select Geography Level:</strong></label>
                      <select id="zone-selector">
                        <option value="sdz" selected>Super Data Zone</option>
                        <option value="dz">Data Zone</option>
                        <option value="dea">District Electoral Area</option>
                      </select>
                    </div>
                    <br>
                    
                                        <div id="toolbar-insertion-point">

                  <h5>Then add areas to your custom area profile by:<br><br> <b>Selecting individual areas on the map</b> <br></b>or<br> <b>Select using the radius selector</b>
                  </h5>

  <div id="draw-toolbar-container"></div>

<div class="nav-button-container cta">
  <div class="center-wrapper">
    <button id="build-profile-btn" class="nav-button">Go to Area Profile</button>
  </div>
</div>
</div>
            

                  <!-- <div class="category-group">
                    <button type="button" class="group-toggle">Local Government Districts ▼</button>
                    <div class="group-content" id="lgd-buttons">
                      <div class="lgd-option">
                        <input type="checkbox" id="lgd-antrim" value="Antrim and Newtownabbey">
                        <label class="lgd-btn" data-lgd="Antrim and Newtownabbey" for="lgd-antrim">Antrim and Newtownabbey</label>
                      </div>

                      <div class="lgd-option">
                        <input type="checkbox" id="lgd-ards" value="Ards and North Down">
                        <label class="lgd-btn" data-lgd="Ards and North Down" for="lgd-ards">Ards and North Down</label>
                      </div>

                      <div class="lgd-option">
                        <input type="checkbox" id="lgd-armagh" value="Armagh City, Banbridge and Craigavon">
                        <label class="lgd-btn" data-lgd="Armagh City, Banbridge and Craigavon" for="lgd-armagh">Armagh City, Banbridge and Craigavon</label>
                      </div>

                      <div class="lgd-option">
                        <input type="checkbox" id="lgd-belfast" value="Belfast">
                        <label class="lgd-btn" data-lgd="Belfast" for="lgd-belfast">Belfast</label>
                      </div>

                      <div class="lgd-option">
                        <input type="checkbox" id="lgd-causeway" value="Causeway Coast and Glens">
                        <label class="lgd-btn" data-lgd="Causeway Coast and Glens" for="lgd-causeway">Causeway Coast and Glens</label>
                      </div>

                      <div class="lgd-option">
                        <input type="checkbox" id="lgd-derry" value="Derry City and Strabane">
                        <label class="lgd-btn" data-lgd="Derry City and Strabane" for="lgd-derry">Derry City and Strabane</label>
                      </div>

                      <div class="lgd-option">
                        <input type="checkbox" id="lgd-fermanagh" value="Fermanagh and Omagh">
                        <label class="lgd-btn" data-lgd="Fermanagh and Omagh" for="lgd-fermanagh">Fermanagh and Omagh</label>
                      </div>

                      <div class="lgd-option">
                        <input type="checkbox" id="lgd-lisburn" value="Lisburn and Castlereagh">
                        <label class="lgd-btn" data-lgd="Lisburn and Castlereagh" for="lgd-lisburn">Lisburn and Castlereagh</label>
                      </div>

                      <div class="lgd-option">
                        <input type="checkbox" id="lgd-mid-east" value="Mid and East Antrim">
                        <label class="lgd-btn" data-lgd="Mid and East Antrim" for="lgd-mid-east">Mid and East Antrim</label>
                      </div>

                      <div class="lgd-option">
                        <input type="checkbox" id="lgd-mid-ulster" value="Mid Ulster">
                        <label class="lgd-btn" data-lgd="Mid Ulster" for="lgd-mid-ulster">Mid Ulster</label>
                      </div>

                      <div class="lgd-option">
                        <input type="checkbox" id="lgd-newry" value="Newry, Mourne and Down">
                        <label class="lgd-btn" data-lgd="Newry, Mourne and Down" for="lgd-newry">Newry, Mourne and Down</label>
                      </div>
                    </div> -->
                  <!-- </div> -->
                   
                  </div>
                  
                  <div id="map"></div>

                  <div class="map-rail" aria-label="Map controls">

                  <div class="about-button-pair">
                    <button id="howto-rail-btn" class="nav-button" data-nav="howto">About</button>
                    <button id="howto-rail-btn-2" class="nav-button">Share</button>
                  </div>
                    <div class="cntrl-button-wrapper rail-card">
                      <h4>Map Controls</h4>
                      
                      <button id="clear-selection-btn">Clear Selections</button>
                      <button id="resetZoomBtn">Reset Zoom</button>
                    </div>


                  </div>

                </div>               
              </div>

            </div>
        </div>
        
        <div id="output-content" class="hidden-section">
          <div id="profile-content">
          
            <div id="output-and-controls">

              <div id="category-selector">
                    <h3>Create your Area Profile</h3>
                    <h5>Select the statistics you wish to see for your chosen areas:</h5>

                    <div class="source-legend" style="margin:.5rem 0;">
                      <span class="source-badge badge-ftb">Flexible Table Builder</span>
                      <span class="source-badge badge-portal">Data Portal</span>
                    </div>
                    <br>

                    <form id="category-form">

                      <div class="category-group">
                        <button type="button" class="group-toggle">People and communities ▼</button>
                        <div class="group-content">
                          <label><input type="checkbox" value="Age (7 Categories)" checked> Age</label>
                          <label><input type="checkbox" value="Sex Label" checked> Sex</label>
                          <label><input type="checkbox" value="Age (MYE)"> Age (MYE)</label>
                          <label><input type="checkbox" value="Sex (MYE)"> Sex (MYE)</label>
                          <label><input type="checkbox" value="Religion"> Religion</label>
                          <label><input type="checkbox" value="Household Composition"> Household Composition</label>
                          <label><input type="checkbox" value="Country of Birth"> Country of Birth</label>
                          <label><input type="checkbox" value="Main Language"> Main Language</label>
                          <label><input type="checkbox" value="Sexual Orientation Label"> Sexual Orientation</label>
                          <label><input type="checkbox" value="Household Dependant Children"> Dependant Children</label>
                          <label><input type="checkbox" value="Household Tenure"> Tenure</label>
                          <label><input type="checkbox" value="Martial and Civil Partnership Status"> Martial and Civil Partnership Status</label> 
                        </div>
                      </div>

                      <div class="category-group">
                        <button type="button" class="group-toggle">Education and skills ▼</button>
                        <div class="group-content">
                          <label><input type="checkbox" value="Qualifications Highest Level"> Qualifications Highest Level</label>
                          <label><input type="checkbox" value="Place of Study Method of Travel"> Place of Study (Method of Travel)</label> 
                          <label><input type="checkbox" value="Place of Study Distance"> Place of Study (Distance)</label> 
                        </div>
                      </div>

                      <div class="category-group">
                        <button type="button" class="group-toggle">Work, pay and benefits ▼</button>
                        <div class="group-content">
                          <label><input type="checkbox" value="Economic Activity"> Economic Activity</label>
                          <label><input type="checkbox" value="Place of Work Distance"> Place of Work (Distance)</label> 
                          <label><input type="checkbox" value="Place of Work Method of Travel"> Place of Work (Method of Travel)</label> 
                          <label><input type="checkbox" value="Occupation Current"> Current Occupation</label> 
                          <label><input type="checkbox" value="Benefits Statistics" checked> Benefits Recipients</label>
                        </div>
                      </div>

                      <div class="category-group">
                        <button type="button" class="group-toggle">Health and social care ▼</button>
                        <div class="group-content">
                          <label><input type="checkbox" value="Health Condition Emotional or Mental Health Label"> Emotional or Mental Health Condition</label>
                          <label><input type="checkbox" value="Health Problem or Disability Long term Label"> Health Problem or Disability (Long-term)</label>
                          <label><input type="checkbox" value="Health in General"> Health in General</label>
                          <label><input type="checkbox" value="Provision of Unpaid Care"> Provision of Unpaid Care</label> 
                        </div>
                      </div>

                      <div class="category-group">
                        <button type="button" class="group-toggle">Transport, environment and climate change ▼</button>
                        <div class="group-content">
                          <label><input type="checkbox" value="Household Car or Van Availability"> Household Car or Van Availability</label>
                          <label><input type="checkbox" value="Household Renewable Energy Systems Label"> Household Renewable Energy Systems</label>                          
                        </div>
                      </div>

                      <div class="category-group">
                        <button type="button" class="group-toggle">Business, economy and trade ▼</button>
                        <div class="group-content"> 
                        </div>
                      </div>

                      <div class="category-group">
                        <button type="button" class="group-toggle">Crime and justice ▼</button>
                        <div class="group-content">
                        </div>
                      </div>

                    </form>
              </div>
              
              <br>
              

<div id="output-panel" style="flex: 1;">
  <div class="breakdown-row">

<div id="breakdown-container">

  <div id="summary-hero" class="summary-flex">
  <div class="summary-top">
    <div class="title-box">
      <h2 id="areaProfileTitle" contenteditable="true">Click to edit title for area profile</h2>
    </div>
    <div class="summary-box">
      <div class="summary-content">
          <h4 style = "margin-top: -49px;">Summary of Areas Selected:</h4>
          <ul id="summaryList"></ul>
        </div>
    </div>
  </div>

  <div class="summary-bottom">
    <div class="population-box">
      <div class="population-label">Population selected</div>
      <div class="population-value" id="totalPopulation">0</div>
    </div>
    <div class="map-box">
      <div id="summary-map"></div>
    </div>
  </div>
</div>

</div>

<div class="button-wrapper">
  <div class="button-row">
    <button id="about-btn" class="nav-button uniform-button">About</button>
    <button id="share-btn" class="nav-button uniform-button">Share</button>

    <div class="dropdown">
      <button
        class="nav-button uniform-button dropdown-toggle"
        type="button"
        id="downloadDropdown"
        data-bs-toggle="dropdown"
        aria-expanded="false"
      >
        Download
      </button>
      <ul class="dropdown-menu" aria-labelledby="downloadDropdown">
        <li><button class="dropdown-item" onclick="downloadExcel()">Download Excel File</button></li>
        <li><button class="dropdown-item" onclick="downloadSummaryImage()">Download Summary Image</button></li>
      </ul>
    </div>
  </div>

  <div class="change-selection-wrapper">
    <button id="change-selection" class="nav-button uniform-button">Change Selections</button>
  </div>
</div>
  </div>

                <!-- <div id="summary-hero">
                    <div id="summary-map"></div>
                    <div id="summary-card"></div>
                </div> -->

                <!-- View Tabs -->
                <div style="display: flex; align-items: stretch; margin-bottom: 1rem;">
                  <button class="view-tab selected" data-view="charts">Charts</button>
                  <button class="view-tab" data-view="tables">Tables</button>
                </div>

                <div id="charts-container"></div>
                <div id="tables-container" style="display: none;"></div>
                <div id="urban-rural-comparison" style="display: none;"></div>
                <div id="urban-rural-charts" style="display: none;"></div>

                <br>
                <hr style="border-top: 5px solid #3878c5; margin: 0">
                <br>
                <button onclick="downloadExcel()">Download Excel File</button>
                <button onclick="downloadSummaryImage()">Download Summary Image</button>

              </div>
              
            </div>

            <h3 style="margin-top: 20px;">Further Information</h3>
            <p style="margin-bottom: 10px;">
              Different breakdowns of the selected datasets are available in most cases. Below are the links to where those currently selected were sourced:<br>
              <div id="sourceId" class="source_name"></div>
            </p>

            <h3 style="margin-top: 20px;">Note on custom area aggregations</h3>
            <p style="margin-bottom: 10px;">

              Any aggregations created from Census Flexible Builder data may differ slightly from published Census figures.
              For Census 2021, NISRA applied two Statistical Disclosure Control strategies: Targeted Record Swapping (TRS) and Cell Key Perturbation (CKP). CKP may add small amounts of variation to some cells. Where two or more different aggregations are created, the totals of all cells may in turn be different. Overall, the differences will be small and should not change the conclusions of any analysis or research. 
            </p>
            <p>
              Linked to the Statistical Disclosure Control Methods applied above, when viewing breakdowns at small geographical levels in this application, cell counts of under 5 may be seen.
              The use of TRS and CKP, mean this number could be anything from 0-4, or could have been swapped with another census record entry elsewhere.
            </p>
            <p>
              For more information, please refer to the NISRA statistical disclosure control methodology: <a href="https://www.nisra.gov.uk/files/nisra/publications/statistical-disclosure-control-methodology-for-2021-census.pdf"  target="_blank">NISRA Statistical Disclosure Control Methodology</a>
            </p>
          
          </div> <!--closes profile content div-->
        </div>

        <footer class="footer mt-auto py-4 bg-nisra text-white">
          <div class="container">
            <!-- 3 column section -->
            <div class="row mb-3">
              <div class="col-md-4">
                <h5 class="footer-headings">Data Tools</h5>
                <ul class="list-unstyled">
                  <li><a href="https://explore.nisra.gov.uk/local-stats/">Local Statistics Explorer</a></li>
                  <li><a href="https://data.nisra.gov.uk">Data Portal</a></li>
                  <li><a href="https://build.nisra.gov.uk/en/">Census Flexible Table Builder</a></li>
                </ul>
              </div>
              <div class="col-md-4">
                <h5 class="footer-headings">Corporate</h5>
                <ul class="list-unstyled">
                  <li><a href="https://www.nisra.gov.uk/">NISRA Website</a></li>
                  <li><a href="https://www.nisra.gov.uk/statistics/about-nisra/careers">Careers</a></li>
                  <li><a href="https://www.nisra.gov.uk/contact">Contact</a></li>
                </ul>
              </div>
              <div class="col-md-4">
                <h5 class="footer-headings">Follow</h5>
                <ul class="list-inline">
                  <li class="list-inline-item">
                    <a href="https://www.facebook.com/nisra.gov.uk">
                      <img src="img/logo/facebook-brands-solid-full.svg" class="img-50"/>
                    </a>
                  </li>
                  <li class="list-inline-item">
                    <a href="https://x.com/NISRA/">
                      <img src="img/logo/x-twitter-brands-solid-full.svg" class="img-50"/>
                    </a>
                  </li>
                  <li class="list-inline-item">
                    <a href="https://www.youtube.com/user/nisrastats">
                      <img src="img/logo/youtube-brands-solid-full.svg" class="img-50"/>
                    </a>
                  </li>
                  <li class="list-inline-item">
                    <a href="https://www.linkedin.com/company/northern-ireland-statistics-and-research-agency/">
                      <img src="img/logo/linkedin-in-brands-solid-full.svg" class="img-50"/>
                    </a>
                  </li>
                </ul>
              </div>
            </div>

            <!-- Horizontal list with separators -->
            <ul class="list-inline footer-links text-center mb-0">
              <li class="list-inline-item"><a href="https://www.nisra.gov.uk/crown-copyright">© Crown Copyright</a></li>
              <li class="list-inline-item">|</li>
              <li class="list-inline-item"><a href="https://www.nisra.gov.uk/terms-and-conditions">Terms and conditions</a></li>
              <li class="list-inline-item">|</li>
              <li class="list-inline-item"><a href="https://www.nisra.gov.uk/cookies">Cookies</a></li>
              <li class="list-inline-item">|</li>
              <li class="list-inline-item"><a href="https://www.nisra.gov.uk/nisra-privacy-notice">Privacy</a></li>
              <li class="list-inline-item">|</li>
              <li class="list-inline-item"><a href="https://www.nisra.gov.uk/accessibility-statement-nisra">Accessibility Statement</a></li>
            </ul>
          </div>
        </footer>
        </div>
    
      </div>   
      </div>
      <hr style="border-top: 10px solid #076cba; margin-bottom: 0; margin-top: 25px;">
      
    </div>
    <div id="select-areas-modal" class="apb-modal-overlay" hidden>
      <div class="apb-modal" role="dialog" aria-modal="true" aria-labelledby="apb-modal-title">
        <h3 id="apb-modal-title" style="margin:0 0 .5rem 0;">Select areas first</h3>
        <p style="margin:0 0 1rem 0;">
          To build an area profile, select one or more areas on the map (or use the multi-area selector).
        </p>
        <div class="apb-modal-actions">
          <button id="apb-modal-focus" class="daera-btn" type="button">Go to selector</button>
          <button id="apb-modal-close" class="btn" type="button">OK</button>
        </div>
      </div>
    </div>
    <script src="https://unpkg.com/maplibre-gl@2.4.0/dist/maplibre-gl.js"></script>
    <link href="https://unpkg.com/maplibre-gl@2.4.0/dist/maplibre-gl.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/@turf/turf@6/turf.min.js"></script>
    <script src="custom.js"></script>

    
  </body>

</html>